<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Speedcooking</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">

    <script src="https://d3js.org/d3.v4.min.js"></script>


  </head>
  <body>
    <nav id="nav" class="navbar navbar-dark bg-primary">
      <a class="navbar-brand" href="">SpeedCooking</a>
      <select class="selectRecipes"></select>
    </nav>



    <svg></svg>


    <script>

      var svg = d3.select("svg")
        .attr("width", 900)
        .attr("height", 400)
        .style("border", "1px solid black")

      svg.append("text")
        .text("Speedcooking")
        .attr("y", 200)
        .attr("x", 120)
        .attr("font-size", 12)
        .attr("font-family", "Lora serif")

      var recipe_chosen;
      var data_recipe;


      d3.json("recettes.json", function(json) {

        console.log(json.recettes)

        var data_recipe = json.recettes[0];
          // on en aura besoin avant de changer le form

        var select = d3.select("select")
          .on("change", function(){
            recipe_chosen = d3.select(".selectRecipes").node().value;

            // Put info with selected information.
            for (var i = 0; i< json.recettes.length; i++){
              if (json.recettes[i].nom == recipe_chosen) {
                data_recipe = json.recettes[i]
              }
            }

            svg.select("text").data([data_recipe])
              .text(function(d){
                return "Recette issue de " + d.source
              })
          })

        select.selectAll("option").data(json.recettes).enter()
          .append("option")
          .attr("value", function(d) {return d.nom})
          .html(function(d) {return d.nom})


        svg.select("text").data(json.recettes)
          .text(function(d){ return "Recette issue de " + d.source})


        // ajout des valeurs en x et y

        // x : calcul de profondeur
        var get_depth = function (i,etapes){
          d = 1;
          console.log("call withb i=");
          console.log(i);
          var children = etapes[i].enfants;
          children.forEach(function (c) {
            d_c = get_depth(c,etapes);
            if (d_c+1 > d) {
              d = d_c+1;
            }
          });
          console.log("return :");
          console.log(d);
          return d;
        };
        depth = get_depth(data_recipe.etapes.length-1,data_recipe.etapes);


        console.log(depth);

      })



    </script>


  </body>
</html>
